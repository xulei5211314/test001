@echo off
setlocal ENABLEDELAYEDEXPANSION
::platform-tools\adb kill-server

@adb devices | findstr "\<device\>"
IF ERRORLEVEL 1 goto NOCONNECTED
goto FINISH

:NOCONNECTED
pause
exit
:FINISH
echo adb root
platform-tools\adb root

::SET SourceFile=dms-sysMng-workflow

::SET J2Path=/app/output_linux_J2/bin/dms-sysMng-workflow

SET APData=/data

SET /p SourceFile=�滻�ļ���(Ĭ�ϴ��복��/dataĿ¼):
SET J2_PATH=/mnt/
SET err=error
if exist %SourceFile% (
	echo %SourceFile%  �ļ�����!
) else (
    echo %SourceFile%  �ļ�������!
	pause
	exit
)

echo APȫ·����%APData%/%SourceFile%
echo J2ȫ·����%J2_PATH%/%SourceFile%

echo "copy��AP Data����"
platform-tools\adb push %SourceFile%  %APData%
platform-tools\adb shell sync
ping -n 1 127.0.0.1>nul
	
echo "���ط���"
platform-tools\adb shell  hbipc-utils run \"mount LABEL="kernelbak" /mnt\" --bifsd
echo "J2��APP������Ϊ��д"
platform-tools\adb shell  hbipc-utils run \"mount -o rw,remount /\" --bifsd
ping -n 2 127.0.0.1>nul

for /f %%i in ('platform-tools\adb shell hbipc-utils put %APData%/%SourceFile%  %J2_PATH%/%SourceFile% --bifsd') do ( set result=%%i)
echo result1=%result%
echo %result1% | findstr %err% >nul && (

) || (

	certutil -hashfile %SourceFile% MD5
	echo "J2�ļ�MD5"
	platform-tools\adb shell  hbipc-utils run \"md5sum %J2_PATH%/%SourceFile% \" --bifsd 
)
ping -n 1 127.0.0.1>nul

echo "sync"
platform-tools\adb shell  hbipc-utils run \"sync \" --bifsd


ping -n 1 127.0.0.1>nul

platform-tools\adb shell  hbipc-utils run \"mount -o ro,remount /\" --bifsd

ping -n 2 127.0.0.1>nul

pause